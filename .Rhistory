     xlab="Predicted p of Y without random effects", ylab="Predicted p of Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
plot(jitter(predictions.num.lrm, amount=0.025), predictions.num.sep, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=ifelse(predictions.cat==df$HAS_RC, "darkgreen", "red"),
     xlab="Predicted p of Y  without random effects", ylab="Predicted p of Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
   text(c(0,0,1,1), c(0.25,0.75,0.25,0.75), c("models agree","models disagree","models disagree","models agree"), srt=90)
# check how the changes mixed-effects model changes the predictions
ftable(df$HAS_RC, predictions.cat, predictions.cat.lrm)
plot(predictions.num.lrm, predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=rgb(0,0,0,25,maxColorValue=255),
     xlab="Predicted p of Y without random effects", ylab="Predicted p of Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
plot(jitter(predictions.num.lrm, amount=0.025), predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=ifelse(predictions.cat==df$HAS_RC, "darkgreen", "red"),
     xlab="Predicted p of Y  without random effects", ylab="Predicted p of Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
   text(c(0,0,1,1), c(0.25,0.75,0.25,0.75), c("models agree","models disagree","models disagree","models agree"), srt=90)
# check how the changes mixed-effects model changes the predictions
ftable(df$HAS_RC, predictions.cat, predictions.cat.lrm)
plot(predictions.num.lrm, predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=rgb(0,0,0,25,maxColorValue=255),
     xlab="Predicted p of Y without random effects", ylab="Predicted p of Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
plot(jitter(predictions.num.lrm, amount=0.05), predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=ifelse(predictions.cat==df$HAS_RC, "darkgreen", "red"),
     xlab="Predicted p of Y  without random effects", ylab="Predicted p of Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
   text(c(0,0,1,1), c(0.25,0.75,0.25,0.75), c("models agree","models disagree","models disagree","models agree"), srt=90)ftable(df$HAS_RC, predictions.cat, predictions.cat.lrm)
plot(predictions.num.lrm, predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=rgb(0,0,0,25,maxColorValue=255),
     xlab="Predicted p of HAS_RC = Y without random effects", ylab="Predicted p of Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
plot(jitter(predictions.num.lrm, amount=0.05), predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=ifelse(predictions.cat==df$HAS_RC, "darkgreen", "red"),
     xlab="Predicted p of HAS_RC = Y without random effects", ylab="Predicted p of Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
   text(c(0,0,1,1), c(0.25,0.75,0.25,0.75), c("models agree","models disagree","models disagree","models agree"), srt=90)
sort(tapply(df$DIFF, df$TEXT, function (qwe) mean(abs(qwe))))
sort(tapply(DIFF, df$CENT, function (qwe) mean(abs(qwe))))
sort(tapply(df$DIFF, df$CENT, function (qwe) mean(abs(qwe))))
summary(m.2.lrm)
summary(m.lmer.final)
drop1(m.3.lmer, test="Chisq")
rowSums
improve.text <- table(df$TEXT, (predictions.cat==df$HAS_RC) & (predictions.cat.lrm!=df$HAS_RC))
   plot(log(rowSums(improve.text)), prop.table(improve.text, 1)[,2], type="n", ylim=c(0, 1), xlab="HAS_RC = Y", ylab="How much the ME/MLM is better in %")
      grid(); text(log(rowSums(improve.text)), prop.table(improve.text, 1)[,2], rownames(improve.text), cex=0.8, font=3)
      # lines(lowess(prop.table(improve.verb, 1)[,2] ~ log(rowSums(improve.verb))))
improve.text <- table(df$TEXT, (predictions.cat==df$HAS_RC) & (predictions.cat.lrm!=df$HAS_RC))
   plot(log(rowSums(improve.text)), prop.table(improve.text, 1)[,2], type="n", ylim=c(0, 1), xlab="Frequency of HAS_RC in text", ylab="How much the ME/MLM is better in %")
      grid(); text(log(rowSums(improve.text)), prop.table(improve.text, 1)[,2], rownames(improve.text), cex=0.8, font=3)
      # lines(lowess(prop.table(improve.verb, 1)[,2] ~ log(rowSums(improve.verb))))as.numeric(Hmisc::somers2(fitted(m.lmer.final), with(x, as.numeric(get(as.character(formula(m.lmer.final)[2]))))-1))[1] # C=0.9545044
as.numeric(Hmisc::somers2(fitted(m.lmer.final), with(x, as.numeric(get(as.character(formula(m.lmer.final)[2]))))-1))[1] # C=0.9545044
as.numeric(Hmisc::somers2(fitted(m.lmer.final), with(df, as.numeric(get(as.character(formula(m.lmer.final)[2]))))-1))[1] # C=0.9545044
improve.text <- table(df$TEXT, (predictions.cat==df$HAS_RC) & (predictions.cat.lrm!=df$HAS_RC))
   plot(log(rowSums(improve.text)), prop.table(improve.text, 1)[,2], type="n", ylim=c(0, 1), xlab="Frequency of HAS_RC in text", ylab="How much the ME/MLM is better in %")
      grid(); text(log(rowSums(improve.text)), prop.table(improve.text, 1)[,2], rownames(improve.text), cex=0.8, font=3)
      # lines(lowess(prop.table(improve.verb, 1)[,2] ~ log(rowSums(improve.verb))))
par(mfrow=c(1,2))
plot(HAS_RC~SA_POS, pch=as.character(df$TEXT), xlim=c(0, 1), ylim=c(0.6, 1.5),
     xlab=expression(paste("An independent variable X (", italic(r)[obs/pred]^2, , "=0.2177184)", sep="")), ylab="A dependent variable Y",
     main="A linear model w/out adjustments for cent/corpus", data=df); grid()
   abline(m.lmer.final, lty=2)obs/
par(mfrow=c(1,2))
plot(HAS_RC~SA_POS, pch=as.character(df$TEXT), xlim=c(0, 1), ylim=c(0.6, 1.5),
     xlab=expression(paste("An independent variable X (", italic(r)[obs/pred]^2, , "=0.2177184)", sep="")), ylab="A dependent variable Y",
     main="A linear model w/out adjustments for cent/corpus", data=df); grid()
   abline(m.lmer.final, lty=2)
plot(HAS_RC~SA_POS, pch=as.character(df$TEXT), xlim=c(0, 1), ylim=c(0.6, 1.5),
     xlab=expression(paste("An independent variable X (", italic(r)[obs/pred]^2, , "=0.6980475)", sep="")), ylab="A dependent variable Y",
     main="Data set 2: A linear mixed-effects model w/ random intercepts"); grid()
   for (i in seq(levels(df$TEXT))) {
      lines(seq(0, 1.5, length.out=20), fixef(m.lmer.final)[1]+ranef(m.lmer.final)[[1]][i,] +
               seq(0, 1.5, length.out=20)*fixef(m.lmer.final)[2])
   }
   abline(a=fixef(m.lmer.final)[1], b=fixef(m.lmer.final)[2], lty=2)
par(mfrow=c(1,2))
plot(HAS_RC~SA_POS, pch=as.character(df$TEXT), xlim=c(0, 1), ylim=c(0.6, 1.5),
     xlab=expression(paste("An independent variable X (", italic(r)[obs/pred]^2, , "=0.2177184)", sep="")), ylab="A dependent variable Y",
     main="A linear model w/out adjustments for cent/corpus", data=df); grid()
   abline(m.lmer.final, lty=2)
plot(HAS_RC~SA_POS, pch=as.character(df$TEXT), xlim=c(0, 1), ylim=c(0.6, 1.5),
     xlab=expression(paste("An independent variable X (", italic(r)[obs/pred]^2, , "=0.6980475)", sep="")), ylab="A dependent variable Y",
     main="Data set 2: A linear mixed-effects model w/ random intercepts", data=df); grid()
   for (i in seq(levels(df$TEXT))) {
      lines(seq(0, 1.5, length.out=20), fixef(m.lmer.final)[1]+ranef(m.lmer.final)[[1]][i,] +
               seq(0, 1.5, length.out=20)*fixef(m.lmer.final)[2])
   }
   abline(a=fixef(m.lmer.final)[1], b=fixef(m.lmer.final)[2], lty=2)par(mfrow=c(1,2))
plot(HAS_RC~SA_POS, pch=as.character(df$TEXT), xlim=c(0, 1), ylim=c(0.6, 1.5),
     xlab=expression(paste("An independent variable X (", italic(r)[obs/pred]^2, , "=0.2177184)", sep="")), ylab="A dependent variable Y",
     main="A linear model w/out adjustments for cent/corpus", data=df); grid()
   abline(m.lmer.final, lty=2)
par(mfrow=c(1,2))
plot(HAS_RC~SA_POS, pch=as.character(df$TEXT), ylim=c(0.6, 1.5),
     xlab=expression(paste("An independent variable X (", italic(r)[obs/pred]^2, , "=0.2177184)", sep="")), ylab="A dependent variable Y",
     main="A linear model w/out adjustments for cent/corpus", data=df); grid()
   abline(m.lmer.final, lty=2)
plot(HAS_RC~SA_POS, pch=as.character(TEXT), ylim=c(0.6, 1.5),
     xlab=expression(paste("An independent variable X (", italic(r)[obs/pred]^2, , "=0.2177184)", sep="")), ylab="A dependent variable Y",
     main="A linear model w/out adjustments for cent/corpus", data=df); grid()
   abline(m.lmer.final, lty=2)
?abline
par(mfrow=c(1,2))
plot(HAS_RC~SA_POS, pch=as.character(TEXT), ylim=c(0.6, 1.5),
     xlab=expression(paste("An independent variable X (", italic(r)[obs/pred]^2, , "=0.2177184)", sep="")), ylab="A dependent variable Y",
     main="A linear model w/out adjustments for cent/corpus", data=df); grid()
   abline(m.lm.2, lty=2)
par(mfrow=c(1,2))
plot(HAS_RC~SA_POS, pch=as.character(TEXT), ylim=c(0.6, 1.5),
     xlab=expression(paste("An independent variable X (", italic(r)[obs/pred]^2, , "=0.2177184)", sep="")), ylab="A dependent variable Y",
     main="A linear model w/out adjustments for cent/corpus", data=df); grid()
   abline(m.2.lrm, lty=2)
par(mfrow=c(1,2))
plot(HAS_RC~SA_POS, pch=as.character(TEXT), ylim=c(0.6, 1.5),
     xlab=expression(paste("An independent variable X (", italic(r)[obs/pred]^2, , "=0.2177184)", sep="")), ylab="A dependent variable Y",
     main="A linear model w/out adjustments for cent/corpus", data=df); grid()
   abline(m.2.lrm, lty=2)
plot(HAS_RC~SA_POS, pch=as.character(TEXT), xlim=c(0, 1), ylim=c(0.6, 1.5),
     xlab=expression(paste("An independent variable X (", italic(r)[obs/pred]^2, , "=0.6980475)", sep="")), ylab="A dependent variable Y",
     main="Data set 2: A linear mixed-effects model w/ random intercepts", data=df); grid()
   for (i in seq(levels(df$TEXT))) {
      lines(seq(0, 1.5, length.out=20), fixef(m.lmer.final)[1]+ranef(m.lmer.final)[[1]][i,] +
               seq(0, 1.5, length.out=20)*fixef(m.lmer.final)[2])
   }
   abline(a=fixef(m.lmer.final)[1], b=fixef(m.lmer.final)[2], lty=2)
par(mfrow=c(1,1))
?poch
??pch
ftable(df$HAS_RC, predictions.cat, predictions.cat.lrm)
plot(predictions.num.lrm, predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=rgb(0,0,0,25,maxColorValue=255),
     xlab="Predicted p of HAS_RC = Y without random effects", ylab="Predicted p of HAS_RC = Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
plot(jitter(predictions.num.lrm, amount=0.05), predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=ifelse(predictions.cat==df$HAS_RC, "darkgreen", "red"),
     xlab="Predicted p of HAS_RC = Y without random effects", ylab="Predicted p of HAS_RC =  Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
   text(c(0,0,1,1), c(0.25,0.75,0.25,0.75), c("models agree","models disagree","models disagree","models agree"), srt=90)
improve.text <- table(df$TEXT, (predictions.cat==df$HAS_RC) & (predictions.cat.lrm!=df$HAS_RC))
   plot(log(rowSums(improve.text)), prop.table(improve.text, 1)[,2], type="n", ylim=c(0, 1), xlab="Frequency of HAS_RC in text", ylab="How much the ME/MLM is better in %")
      grid(); text(log(rowSums(improve.text)), prop.table(improve.text, 1)[,2], rownames(improve.text), cex=0.8, font=3)
      # lines(lowess(prop.table(improve.verb, 1)[,2] ~ log(rowSums(improve.verb))))
# Curious that it would be so much better for some texts, but not better at all for others...confint(m.lmer.final, parm="beta_", method="boot", nsim=250) # CI of fixed effects
confint(m.lmer.final, parm="beta_", method="boot", nsim=250) # CI of fixed effects
df$cases
summary(df)
rownames(df)
plot(residuals(m.lmer.final), type="h", ylim=c(-0.3, 0.3),
     col=rainbow(length(levels(df$TEXT)))[as.numeric(df$TEXT)]); grid()
   text(rownames(df),
        residuals(m.lmer.final),
        col=rainbow(length(levels(df$text))[as.numeric(df$text)])
   text(tapply(rownames(df), df$TEXT, mean), 0.2, levels(NAME)) # or the next one
   # text(tapply(CASE, NAME, mean),
   #      tapply(residuals(model.final), NAME, function (qwe) max(abs(qwe))),
   #      levels(NAME))
plot(residuals(m.lmer.final), type="h", ylim=c(-0.3, 0.3),
     col=rainbow(length(levels(df$TEXT)))[as.numeric(df$TEXT)]); grid()
   text(rownames(df),
        residuals(m.lmer.final),
        col=rainbow(length(levels(df$text))[as.numeric(df$text)]))
   text(tapply(rownames(df), df$TEXT, mean), 0.2, levels(NAME)) # or the next one
   # text(tapply(CASE, NAME, mean),
   #      tapply(residuals(model.final), NAME, function (qwe) max(abs(qwe))),
   #      levels(NAME))
plot(residuals(m.lmer.final), type="h", ylim=c(-0.3, 0.3),
     col=rainbow(length(levels(df$TEXT)))[as.numeric(df$TEXT)]); grid()
   text(rownames(df),
        residuals(m.lmer.final),
        col=rainbow(length(levels(df$text))[as.numeric(df$text)]))
   text(tapply(rownames(df), df$TEXT, mean), 0.2, levels(df$TEXT)) # or the next one
   # text(tapply(CASE, NAME, mean),
   #      tapply(residuals(model.final), NAME, function (qwe) max(abs(qwe))),
   #      levels(NAME))
plot(residuals(m.lmer.final), type="h", ylim=c(-0.3, 0.3),
     col=rainbow(length(levels(df$TEXT)))[as.numeric(df$TEXT)]); grid()
plot(m.lmer.final, type=c("p", "smooth"), id=0.05)
plot(m.lmer.final, resid(.) ~ fitted(.) | df$TEXT, abline=c(h=0), lty=1, type=c("p", "smooth"))
plot(m.lmer.final, resid(.) ~ fitted(.) | TEXT, abline=c(h=0), lty=1, type=c("p", "smooth"))
plot(m.lmer.final, type=c("p", "smooth"), id=0.05)
m.4.lmer <- glmer(HAS_RC~SA_POS+(1|CENT/TEXT), data=df, family="binomial")
stripchart(residuals(m.4.lmer) ~ USED, method="jitter")
plot(m.4.lmer, type=c("p", "smooth"), id=0.05)
plot(model.final, type=c("p", "smooth"), id=0.05)
plot(model.final, resid(.) ~ fitted(.) | NAME, abline=c(h=0), lty=1, type=c("p", "smooth"))
m.4.lmer <- glmer(HAS_RC~SA_POS+(1|CENT/TEXT), data=df, family="binomial")
plot(m.4.lmer, type=c("p", "smooth"), id=0.05)
plot(m.4.lmer, resid(.) ~ fitted(.) | TEXT, abline=c(h=0), lty=1, type=c("p", "smooth"))
plot(m.lmer.final, type=c("p", "smooth"), id=0.05)
plot(m.lmer.final, resid(.) ~ fitted(.) | TEXT, abline=c(h=0), lty=1, type=c("p", "smooth"))
improve.text <- table(df$TEXT, (predictions.cat==df$HAS_RC) & (predictions.cat.lrm!=df$HAS_RC))
   plot(log(rowSums(improve.text)), prop.table(improve.text, 1)[,2], type="n", ylim=c(0, 1), xlab="Frequency of HAS_RC in text", ylab="How much the ME/MLM is better in %")
      grid(); text(log(rowSums(improve.text)), prop.table(improve.text, 1)[,2], rownames(improve.text), cex=0.8, font=3)
      # lines(lowess(prop.table(improve.verb, 1)[,2] ~ log(rowSums(improve.verb))))
## exploring residuals against fitted
plot(m.lmer.final, type=c("p", "smooth"), id=0.05)
plot(m.lmer.final, resid(.) ~ fitted(.) | TEXT, abline=c(h=0), lty=1, type=c("p", "smooth"))
# I frankly don't know how to fix this.
stripchart(residuals(m.lmer.final) ~ df$SA_POS, method="jitter")
# check how the changes mixed-effects model changes the predictions
ftable(df$HAS_RC, predictions.cat, predictions.cat.lrm)
plot(predictions.num.lrm, predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=rgb(0,0,0,25,maxColorValue=255),
     xlab="Predicted p of HAS_RC = Y without random effects", ylab="Predicted p of HAS_RC = Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
plot(jitter(predictions.num.lrm, amount=0.05), predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=ifelse(predictions.cat==df$HAS_RC, "darkgreen", "red"),
     xlab="Predicted p of HAS_RC = Y without random effects", ylab="Predicted p of HAS_RC =  Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
   text(c(0,0,1,1), c(0.25,0.75,0.25,0.75), c("models agree","models disagree","models disagree","models agree"), srt=90)stripchart(residuals(m.lmer.final) ~ df$SA_POS, method="jitter")
plot(df$HAS_RC ~ df$TEXT)
plot(df$SA_POS ~ df$TEXT)
# check how the changes mixed-effects model changes the predictions
ftable(df$HAS_RC, predictions.cat, predictions.cat.lrm)
plot(predictions.num.lrm, predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=rgb(0,0,0,25,maxColorValue=255),
     xlab="Predicted p of HAS_RC = Y without random effects", ylab="Predicted p of HAS_RC = Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
plot(jitter(predictions.num.lrm, amount=0.05), predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=ifelse(predictions.cat==df$HAS_RC, "darkgreen", "red"),
     xlab="Predicted p of HAS_RC = Y without random effects", ylab="Predicted p of HAS_RC =  Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
   text(c(0,0,1,1), c(0.25,0.75,0.25,0.75), c("models agree","models disagree","models disagree","models agree"), srt=90)sa.pos <- effect("SA_POS", m.lmer.final, type="response", ylim=c(0, 1), grid=TRUE)
preds.hyp <- data.frame(sa.pos$x, PREDICTIONS=ilogit(sa.pos$fit), LOWER=ilogit(sa.pos$lower), UPPER=ilogit(sa.pos$upper))
plot(preds.hyp$SA_POS, preds.hyp$PREDICTIONS, type="n", xlab="Position of sá with respect to head", ylab="Predicted probability of RC present", axes=FALSE)
sa.pos <- effect("SA_POS", m.lmer.final, type="response", ylim=c(0, 1), grid=TRUE)
preds.hyp <- data.frame(sa.pos$x, PREDICTIONS=ilogit(sa.pos$fit), LOWER=ilogit(sa.pos$lower), UPPER=ilogit(sa.pos$upper))
plot(preds.hyp$SA_POS, preds.hyp$PREDICTIONS, type="n", xlab="Position of sá with respect to head", ylab="Predicted probability of RC present", axes=FALSE)
sa.pos <- effect("SA_POS", m.lmer.final, type="response", ylim=c(0, 1), grid=TRUE)
preds.hyp <- data.frame(sa.pos$x, PREDICTIONS=ilogit(sa.pos$fit), LOWER=ilogit(sa.pos$lower), UPPER=ilogit(sa.pos$upper))
plot(preds.hyp$SA_POS, preds.hyp$PREDICTIONS, type="n", xlab="Position of sá with respect to head", ylab="Predicted probability of RC present", axes=FALSE)
plot(sa.pos)
summary(preds.hyp)
sa.pos$x
sa.pos$fit
plot(preds.hyp$SA_POS, preds.hyp$PREDICTIONS, xlab="Position of sá with respect to head", ylab="Predicted probability of RC present", axes=FALSE)
plot(sa.pos <- effect("SA_POS", m.lmer.final, type="response", ylim=c(0, 1), grid=TRUE))
nrow(TEXT)
nrow(df$TEXT)
df$TEXT
summary(df)
unique(df$TEXT)
re.text <- ranef(m.lmer.final)$TEXT[,1]
   names(re.text) <- rownames(ranef(m.lmer.final)$TEXT)
   re.text["reportage"]
re.text <- ranef(m.lmer.final)$TEXT[,1]
   names(re.text) <- rownames(ranef(m.lmer.final)$TEXT)
   re.text["reportage"]
ranef(m.lmer.final)
ranef(m.lmer.final)$TEXT
   names(re.text) <- rownames(ranef(m.lmer.final)$TEXT)
   re.text["reportage"]
re.text
text.predictions <- list()
for (i in 1:24) {
   text.predictions[[names(re.text)[i]]] <-
   data.frame(sa.pos$x, PREDICTION=ilogit(sa.pos$fit+re.text[i]),
              LOWER=ilogit(sa.pos$lower+re.text[i]), UPPER=ilogit(sa.pos$upper+re.text[i]))
}
text.predictions
nrow(text.predictions)
len(text.predictions)
count
count()
num()
summary(text.predictions)
text.predictions.[0]
text.predictions[0]
text.predictions[[0]]
text.predictions
text.predictions$x
str(text.predictions)
plot(preds.hyp$SA_POS, preds.hyp$PREDICTIONS, xlab="Position of sá with respect to head", ylab="Predicted probability of RC present", axes=FALSE)
   axis(1, at=0:4, labels=roundy(c(1, exp(1:4)), 1)); axis(2); abline(v=c(log(seq(0, 60, 5))), col="lightgrey", lty=2)
   for (i in 1:24) {
      qwe <- split(text.predictions[[i]], text.predictions[[i]][,2])
      lines(qwe[[1]]$SA_POS, qwe[[1]]$PREDICTION, col="blue")
      lines(qwe[[2]]$SA_POS, qwe[[2]]$PREDICTION, col="red")
   }
   legend(3, 0.3, fill=c("blue", "red"), legend=c("lex", "nonlex"), xjust=0.5, yjust=0.5)plot(sa.pos <- effect("SA_POS", m.lmer.final, type="response", ylim=c(0, 1), grid=TRUE))
preds.hyp <- data.frame(sa.pos$x, PREDICTIONS=ilogit(sa.pos$fit), LOWER=ilogit(sa.pos$lower), UPPER=ilogit(sa.pos$upper))
re.text <- ranef(m.lmer.final)$TEXT[,1]
   names(re.text) <- rownames(ranef(m.lmer.final)$TEXT)
   re.text["reportage"]
text.predictions <- list()
for (i in 1:24) {
   text.predictions[[names(re.text)[i]]] <-
   data.frame(sa.pos$x, PREDICTION=ilogit(sa.pos$fit+re.text[i]),
              LOWER=ilogit(sa.pos$lower+re.text[i]), UPPER=ilogit(sa.pos$upper+re.text[i]))
}
text.predictions <- list()
for (i in 1:24) {
   text.predictions[[names(re.text)[i]]] <-
   data.frame(sa.pos$x, PREDICTION=ilogit(sa.pos$fit+re.text[i]),
              LOWER=ilogit(sa.pos$lower+re.text[i]), UPPER=ilogit(sa.pos$upper+re.text[i]))
}
plot(sa.pos <- effect("SA_POS", m.lmer.final, type="response", ylim=c(0, 1), grid=TRUE))
text.predictions <- list()
for (i in 1:24) {
   text.predictions[[names(re.text)[i]]] <-
   data.frame(sa.pos$x, PREDICTION=ilogit(sa.pos$fit+re.text[i]),
              LOWER=ilogit(sa.pos$lower+re.text[i]), UPPER=ilogit(sa.pos$upper+re.text[i]))
}
   for (i in 1:24) {
      qwe <- split(text.predictions[[i]], text.predictions[[i]][,2])
      lines(qwe[[1]]$SA_POS, qwe[[1]]$PREDICTION, col="blue")
      lines(qwe[[2]]$SA_POS, qwe[[2]]$PREDICTION, col="red")
   }
   plot(sa.pos); for (i in 1:24) {
      qwe <- split(text.predictions[[i]], text.predictions[[i]][,2])
      lines(qwe[[1]]$SA_POS, qwe[[1]]$PREDICTION, col="blue")
      lines(qwe[[2]]$SA_POS, qwe[[2]]$PREDICTION, col="red")
   }
  for (i in 1:24) {
      qwe <- split(text.predictions[[i]], text.predictions[[i]][,2])
      lines(qwe[[1]]$SA_POS, qwe[[1]]$PREDICTION, col="blue")
      lines(qwe[[2]]$SA_POS, qwe[[2]]$PREDICTION, col="red")
   }; plot(sa.pos);
   plot(sa.pos)
   for (i in 1:24) {
      qwe <- split(text.predictions[[i]], text.predictions[[i]][,2])
      lines(qwe[[1]]$SA_POS, qwe[[1]]$PREDICTION, col="blue")
      lines(qwe[[2]]$SA_POS, qwe[[2]]$PREDICTION, col="red")
   }
ftable(df$HAS_RC, predictions.cat, predictions.cat.lrm)
plot(predictions.num.lrm, predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=rgb(0,0,0,25,maxColorValue=255),
     xlab="Predicted p of HAS_RC = Y without random effects", ylab="Predicted p of HAS_RC = Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
plot(jitter(predictions.num.lrm, amount=0.05), predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=ifelse(predictions.cat==df$HAS_RC, "darkgreen", "red"),
     xlab="Predicted p of HAS_RC = Y without random effects", ylab="Predicted p of HAS_RC =  Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
   text(c(0,0,1,1), c(0.25,0.75,0.25,0.75), c("models agree","models disagree","models disagree","models agree"), srt=90)
   plot(sa.pos)
   axis(1, at=0:4, labels=roundy(c(1, exp(1:4)), 1)); axis(2); abline(v=c(log(seq(0, 60, 5))), col="lightgrey", lty=2)
   for (i in 1:24) {
      qwe <- split(text.predictions[[i]], text.predictions[[i]][,2])
      lines(qwe[[1]]$SA_POS, qwe[[1]]$PREDICTION, col="blue")
      lines(qwe[[2]]$SA_POS, qwe[[2]]$PREDICTION, col="red")
   }
   plot(sa.pos)
   axis(1, at=0:4, labels=roundy(c(1, exp(1:4)), 1)); axis(2); abline(v=c(log(seq(0, 60, 5))), col="lightgrey", lty=2)
   for (i in 1:24) {
      qwe <- split(text.predictions[[i]], text.predictions[[i]][,2])
      lines(qwe[[1]]$SA_POS, qwe[[1]]$PREDICTION, col="blue")
      lines(qwe[[2]]$SA_POS, qwe[[2]]$PREDICTION, col="red")
   }
   plot(sa.pos)
   axis(1, at=0:4, labels=round(c(1, exp(1:4)), 1)); axis(2); abline(v=c(log(seq(0, 60, 5))), col="lightgrey", lty=2)
   for (i in 1:24) {
      qwe <- split(text.predictions[[i]], text.predictions[[i]][,2])
      lines(qwe[[1]]$SA_POS, qwe[[1]]$PREDICTION, col="blue")
      lines(qwe[[2]]$SA_POS, qwe[[2]]$PREDICTION, col="red")
   }
   legend(3, 0.3, fill=c("blue", "red"), legend=c("lex", "nonlex"), xjust=0.5, yjust=0.5)
text.predictions
text.predictions[[0]]
text.predictions[[0]]$SA_POS
plot_model
   library(sjPlot)
(pp <- plot_model(m.lmer.final,type="pred",
       terms=c("SA_POS","TEXT"),pred.type="re"))
   library(sjPlot)
(pp <- plot_model(m.lmer.final,type="pred",
       terms=c("SA_POS","TEXT"),pred.type="re"))
plot(preds.hyp$SA_POS, preds.hyp$PREDICTIONS, xlab="Position of sá with respect to head", ylab="Predicted probability of RC present", axes=FALSE)
plot(preds.hyp$SA_POS, preds.hyp$PREDICTIONS, xlab="Position of sá with respect to head", ylab="Predicted probability of RC present", axes=FALSE)
sa.pos <- effect("SA_POS", m.lmer.final, type="response", ylim=c(0, 1), grid=TRUE)
sa.pos
   plot(sa.pos)
   for (i in 1:24) {
      qwe <- split(text.predictions[[i]], text.predictions[[i]][,2])
      lines(qwe[[1]]$SA_POS, qwe[[1]]$PREDICTION, col="blue")
      lines(qwe[[2]]$SA_POS, qwe[[2]]$PREDICTION, col="red")
   }
   plot(sa.pos)
   for (i in 1:24) {
      qwe <- split(text.predictions[[i]], text.predictions[[i]][,2])
      lines(qwe[[1]]$SA_POS, qwe[[1]]$PREDICTION, col="blue")
      lines(qwe[[2]]$SA_POS, qwe[[2]]$PREDICTION, col="red")
   }
 plot(sa.pos); for (i in 1:24) {
      qwe <- split(text.predictions[[i]], text.predictions[[i]][,2])
      lines(qwe[[1]]$SA_POS, qwe[[1]]$PREDICTION, col="blue")
      lines(qwe[[2]]$SA_POS, qwe[[2]]$PREDICTION, col="red")
   }
   plot(sa.pos); for (i in 1:24) {
      qwe <- split(text.predictions[[i]], text.predictions[[i]][,2])
      abline(qwe[[1]]$SA_POS, qwe[[1]]$PREDICTION, col="blue")
      abline(qwe[[2]]$SA_POS, qwe[[2]]$PREDICTION, col="red")
   }
plot(df$HAS_RC)
plot(df$SA_POS ~ df$CENT)
re.text
re.text
re.text
str(re.text)
re.text
ftable(df$HAS_RC, predictions.cat, predictions.cat.lrm)
plot(predictions.num.lrm, predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=rgb(0,0,0,25,maxColorValue=255),
     xlab="Predicted p of HAS_RC = Y without random effects", ylab="Predicted p of HAS_RC = Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
plot(jitter(predictions.num.lrm, amount=0.05), predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=ifelse(predictions.cat==df$HAS_RC, "darkgreen", "red"),
     xlab="Predicted p of HAS_RC = Y without random effects", ylab="Predicted p of HAS_RC =  Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
   text(c(0,0,1,1), c(0.25,0.75,0.25,0.75), c("models agree","models disagree","models disagree","models agree"), srt=90)
confusionMatrix(table(df$HAS_RC, predictions.cat))
sjp.glmer
sjPlot.glmer
library(sjPlot)
sjp.glmer
plot_model(m.lmer.final, type = "re.qq")
plot_model(m.lmer.final, type = "diag")
ranef(m.lmer.final)
?lines
str(ranef(m.lmer.final))
str(ranef(m.lmer.final)$TEXT
)
ranef(m.lmer.final)$TEXT[,1]
ranef(m.lmer.final)$TEXT
ranef(m.lmer.final)
ranef(m.lmer.final)$TEXT[,1]
?lines
sa.pos
str(sa.pos)
sa.pos
sa.pos + ranef(m.lmer.final)$TEXT[,1]
ranef(m.lmer.final)$TEXT[,1]
sa.pos
   plot(sa.pos); for (i in 1:24) {
      abline(sa.pos + ranef(m.lmer.final)$TEXT[i,1]
   }
   plot(sa.pos); 
   for (i in 1:24) {
      abline(sa.pos + ranef(m.lmer.final)$TEXT[i,1])
   }
sa.pos
ranef(m.lmer.final)$TEXT[1,1]
ranef(m.lmer.final)$TEXT[,1]
sa.pos
sa.pos[1]
sa.pos[,1]
sa.pos[2]
sa.pos
sa['BEFORE']
sa.pos['BEFORE']
sa.pos['BEFORE',]
ranef(m.lmer.final)$TEXT[,1]
   for (i in 1:24) {
      abline(ranef(m.lmer.final)$TEXT[i,1], coef(sa.pos))
   }
   plot(sa.pos); 
   for (i in 1:24) {
      abline(ranef(m.lmer.final)$TEXT[i,1], coef(sa.pos))
   }
ranef(m.lmer.final)$TEXT[,1]
   plot(sa.pos)
   for (i in 1:24) {
      abline(ranef(m.lmer.final)$TEXT[i,1], coef(sa.pos))
   }
?plot
   plot(sa.pos, type="n")
   for (i in 1:24) {
      abline(ranef(m.lmer.final)$TEXT[i,1], coef(sa.pos))
   }
   plot(sa.pos, type="n")
   for (i in 1:24) {
      abline(ranef(m.lmer.final)$TEXT[i,1], coef(sa.pos))
   }
   plot(effect("SA_POS", m.lmer.final, type="response", ylim=c(0, 1), grid=TRUE), type="n")
?plot
   plot(x=sa.pos, type="n")
   plot(x=sa.pos, type="n")
?plot
effect("SA_POS", m.lmer.final, type="response", ylim=c(0, 1), grid=TRUE)
 abline(1, 2)
   plot(sa.pos)
   abline(1, 2)
   plot(sa.pos)
   abline(1, 2)
   plot(sa.pos <- effect("SA_POS", m.lmer.final, type="response", ylim=c(0, 1), grid=TRUE), type="n")
   {plot(sa.pos)
   abline(1, 2)}
   {plot(sa.pos)
   abline(1, 2)}
   plot(sa.pos) +abline(1, 2)
args(plot.default)
   plot(sa.pos, y=NULL) +abline(1, 2)
   plot(sa.pos, y=NULL, type="n") +abline(1, 2)
   plot(sa.pos, y=NULL, type="n"); abline(1, 2)
   plot(sa.pos) +
   abline(v=c(15,20), col=c("blue", "red"), lty=c(1,2), lwd=c(1, 3))
   plot(sa.pos) +
   abline(v=c(15,20), col=c("blue", "red"), lty=c(1,2), lwd=c(1, 3))
   plot(sa.pos)
   abline(v=c(15,20), col=c("blue", "red"), lty=c(1,2), lwd=c(1, 3))
   plot(sa.pos, add=TRUE)
=c(1, 3))
   abline(v=c(15,20), col=c("blue", "red"), lty=c(1,2), lwd=c(1, 3))
?plot
?plot.default
?plot
   plot(sa.pos, type="n")
plot_model(m.lmer.final)
plot_model(m.lmer.final, type = "diag")
>    plot(sa.pos) +
   plot(sa.pos)
?plot(sa.pos)
## Check how the mixed effect model improves predictions from the fixed effects model
ftable(df$HAS_RC, predictions.cat, predictions.cat.lrm)
plot(predictions.num.lrm, predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=rgb(0,0,0,25,maxColorValue=255),
     xlab="Predicted p of HAS_RC = Y without random effects", ylab="Predicted p of HAS_RC = Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
### Visualization
## Check how the mixed effect model improves predictions from the fixed effects model
ftable(df$HAS_RC, predictions.cat, predictions.cat.lrm)
plot(jitter(predictions.num.lrm, amount=0.05), predictions.num, xlim=c(0, 1), ylim=c(0, 1), pch=16, col=ifelse(predictions.cat==df$HAS_RC, "darkgreen", "red"),
     xlab="Predicted p of HAS_RC = Y without random effects", ylab="Predicted p of HAS_RC =  Y with random effects")
   abline(h=0.5, lty=2); abline(v=0.5, lty=2); abline(0, 1)
   text(c(0,0,1,1), c(0.25,0.75,0.25,0.75), c("models agree","models disagree","models disagree","models agree"), srt=90)
## Plotting the only significant fixed effect
plot(effect("SA_POS", m.lmer.final, type="response", ylim=c(0, 1), grid=TRUE))
plot(effect("SA_POS", m.lmer.final, type="response", ylim=c(0, 1), grid=TRUE))
summary(m.lmer.final)
